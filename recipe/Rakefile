
file 'node_modules' do 
  sh "npm install"
end 
task :install => 'node_modules'

task :dev => [:install] do 
  pids = []
  
  pids << spawn("npm run res:dev")
  pids << spawn("npm run start")
  
  trap("INT") do
    pids.each { |pid| 
      puts "killing process #{pid}"
      Process.kill("TERM", pid) rescue nil 
    }
    exit
  end
  
  pids.each { |pid| Process.wait(pid) }
end

task :format => [:install] do 
  sh "npx rescript format -all "
end